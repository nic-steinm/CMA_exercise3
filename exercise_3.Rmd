---
title: "R-Exercise Week 3, Segementation and Similarity "
output: html_notebook
---

Task 1:

```{r}
library(readr)        
library(dplyr)        
library(ggplot2)      
library(sf)          
library(terra)        
library(lubridate)
library(zoo)

#reading in the data
caro <- read_csv("data/caro60.csv")

#sampling interval is chosen to be 5 minutes.

caro <- caro %>%
  mutate(
    n_minus3 = sqrt((lag(E,3)-E)^2+(lag(N,3)-N)^2),
    n_minus2 = sqrt((lag(E,2)-E)^2+(lag(N,2)-N)^2), #distance to pos -2 minutes
    n_minus1 = sqrt((lag(E,1)-E)^2+(lag(N,1)-N)^2),
    n_plus1 = sqrt((E-lead(E,1))^2+(N-lead(N,1))^2),
    n_plus2 = sqrt((E-lead(E,2))^2+(N-lead(N,2))^2),
    n_plus3 = sqrt((E-lead(E,3))^2+(N-lead(N,3))^2)
  ) %>%
  
  rowwise() %>%
  
  mutate(
    stepMean = mean(c(n_minus2, n_minus1, n_minus3, n_plus1, n_plus2, n_plus3))
  ) %>%
  
  ungroup()
  
```

Task 2

```{r}
  
hist(x = caro$stepMean, breaks = 60)
boxplot(caro$stepMean)

caro <- caro %>%
  mutate(static = stepMean < mean(stepMean, na.rm =TRUE)) #Assign boolean if the step-mean is below threshold (= mean of all stepmeans)

caro_filtered <- caro %>%
  filter(!static)
```

Task 3
```{r}
ggplot(caro, aes(x = E, y = N, colour = static), alpha = 0.5)+
  geom_path()+
  geom_point()+
  coord_fixed()

```

Task 4

```{r}

rle_id <- function(vec){
  x <- rle(vec)$lengths
  as.factor(rep(seq_along(x), times=x))
  }


caro <- caro %>%
  mutate(
    segment_id = rle_id(static)
  )%>%
  
  group_by(segment_id)%>%
  
  mutate(
    segment_length = n(),
    segment_time = difftime(max(DatetimeUTC), min(DatetimeUTC))
  )%>%
  ungroup()
  
  
caro1 <- filter(caro, !static)

caro2 <- filter(caro1, segment_time > 300)
  
ggplot(caro1, aes(x = E, y = N, colour = segment_id), alpha = 0.5)+
  labs(title = "Trajectories")+
  geom_path()+
  geom_point()+
  coord_fixed()

ggplot(caro2, aes(x = E, y = N, colour = segment_id), alpha = 0.5)+
  labs(title = "Trajectories over 5 minutes in length")+
  geom_path()+
  geom_point()+
  coord_fixed()
```
Task 5
```{r}


```
